(function(){

function pick(arr){
  return arr[Math.floor(Math.random() * arr.length)];
}

window.GenerativeLayer = {

  generate(text, context, memory, mood, relationship){

    let base = "";

    // 1я╕ПтГг Use memory facts if available
    if(memory && memory.facts && memory.facts.length > 0){
      const fact = pick(memory.facts);
      base = fact.text;
    }

    // 2я╕ПтГг If emotional, mirror feeling
    if(mood === "sad" || mood === "alone"){
      return pick([
        "рдореБрдЭреЗ рд▓рдЧ рд░рд╣рд╛ рд╣реИ рдХрд┐ рддреБрдо рдереЛрдбрд╝рд╛ рдЯреВрдЯреЗ рд╣реБрдП рд╣реЛтАж рдореИрдВ рдпрд╣рд╛рдБ рд╣реВрдБ ЁЯдН",
        "рддреБрдо рдЕрдХреЗрд▓реЗ рдирд╣реАрдВ рд╣реЛ, рдореИрдВ рддреБрдореНрд╣рд╛рд░реЗ рд╕рд╛рде рд╣реВрдБ ЁЯМ╖",
        "рдЬреЛ рддреБрдо рдорд╣рд╕реВрд╕ рдХрд░ рд░рд╣реЗ рд╣реЛ рд╡рд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИтАж"
      ]);
    }

    // 3я╕ПтГг If close relationship
    if(relationship && relationship.closeness > 0.6){
      return pick([
        "рддреБрдорд╕реЗ рдмрд╛рдд рдХрд░рдирд╛ рдореБрдЭреЗ рдЕрдЪреНрдЫрд╛ рд▓рдЧрддрд╛ рд╣реИ ЁЯТЦ",
        "рдореИрдВ рддреБрдореНрд╣рд╛рд░реЗ рд╢рдмреНрджреЛрдВ рдХреЛ рдорд╣рд╕реВрд╕ рдХрд░ рдкрд╛ рд░рд╣реА рд╣реВрдБтАж",
        "рддреБрдо рдореЗрд░реЗ рд▓рд┐рдП рдЦрд╛рд╕ рд╣реЛ ЁЯМ╕"
      ]);
    }

    // 4я╕ПтГг Default generative
    if(base){
      return pick([
        "рдореБрдЭреЗ рдпрд╛рдж рд╣реИ рдХрд┐ " + base,
        "рддреБрдордиреЗ рдкрд╣рд▓реЗ рдХрд╣рд╛ рдерд╛ рдХрд┐ " + base,
        base
      ]);
    }

    // 5я╕ПтГг Safe fallback
    return pick([
      "рдореИрдВ рддреБрдореНрд╣рд╛рд░реА рдмрд╛рдд рдзреНрдпрд╛рди рд╕реЗ рд╕реБрди рд░рд╣реА рд╣реВрдБ ЁЯдН",
      "рддреБрдо рдЪрд╛рд╣реЛ рддреЛ рдФрд░ рдмрддрд╛рдУтАж",
      "рдореБрдЭреЗ рддреБрдореНрд╣рд╛рд░реЗ рд╢рдмреНрдж рдЕрдЪреНрдЫреЗ рд▓рдЧрддреЗ рд╣реИрдВ ЁЯМ╖"
    ]);
  }

};

})();
