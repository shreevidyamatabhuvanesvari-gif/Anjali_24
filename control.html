/* ===================================================
   üß† HONEST MCQ ENGINE
   Article ‚Üí Fact ‚Üí Exam MCQ
=================================================== */

function extractFacts(){
 if(!currentTopic) return alert("‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç");

 const text = article.value.trim();
 if(text.length < 80) return alert("‡§≤‡•á‡§ñ ‡§õ‡•ã‡§ü‡§æ ‡§π‡•à");

 const exam = currentExam;
 const subject = currentSubject;
 const topic = currentTopic;

 let facts = [];

 /* ---------- Years / Dates ---------- */
 const years = text.match(/\d{3,4}\s*(‡§à‡§∏‡§æ\s*‡§™‡•Ç‡§∞‡•ç‡§µ|‡§à‡§∏‡•ç‡§µ‡•Ä)?/g);
 if(years){
   years.slice(0,3).forEach(y=>{
     facts.push({
       q: "‡§≤‡•á‡§ñ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§®‡§ø‡§Æ‡•ç‡§® ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•å‡§®-‡§∏‡§æ ‡§µ‡§∞‡•ç‡§∑ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à?",
       ans: y
     });
   });
 }

 /* ---------- Famous persons ---------- */
 const people = ["‡§¨‡§æ‡§¨‡§∞","‡§Ö‡§ï‡§¨‡§∞","‡§ú‡§π‡§æ‡§Å‡§ó‡•Ä‡§∞","‡§∂‡§æ‡§π‡§ú‡§π‡§æ‡§Å","‡§î‡§∞‡§Ç‡§ó‡§ú‡§º‡•á‡§¨","‡§ó‡§æ‡§Ç‡§ß‡•Ä","‡§®‡•á‡§π‡§∞‡•Ç","‡§∏‡•Å‡§≠‡§æ‡§∑","‡§§‡§ø‡§≤‡§ï","‡§™‡§ü‡•á‡§≤"];
 people.forEach(p=>{
   if(text.includes(p)){
     facts.push({
       q: p + " ‡§ï‡§æ ‡§â‡§≤‡•ç‡§≤‡•á‡§ñ ‡§≤‡•á‡§ñ ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§∏ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à?",
       ans: p
     });
   }
 });

 /* ---------- Dynasties / States ---------- */
 const dyn = ["‡§Æ‡•Å‡§ó‡§º‡§≤","‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≤‡•ç‡§§‡§®‡§§","‡§¨‡•ç‡§∞‡§ø‡§ü‡§ø‡§∂","‡§Æ‡§∞‡§æ‡§†‡§æ","‡§ó‡•Å‡§™‡•ç‡§§","‡§Æ‡•å‡§∞‡•ç‡§Ø","‡§ñ‡§ø‡§≤‡§ú‡•Ä","‡§§‡•Å‡§ó‡§≤‡§ï","‡§≤‡•ã‡§¶‡•Ä"];
 dyn.forEach(d=>{
   if(text.includes(d)){
     facts.push({
       q: "‡§≤‡•á‡§ñ ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§∏ ‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂ ‡§Ø‡§æ ‡§∏‡§§‡•ç‡§§‡§æ ‡§ï‡§æ ‡§â‡§≤‡•ç‡§≤‡•á‡§ñ ‡§π‡•à?",
       ans: d
     });
   }
 });

 /* ---------- Economy ---------- */
 if(text.includes("‡§ï‡•É‡§∑‡§ø") || text.includes("‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞") || text.includes("‡§ï‡§∞")){
   facts.push({
     q: "‡§≤‡•á‡§ñ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ö‡§∞‡•ç‡§•‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ï‡§ø‡§∏ ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§•‡•Ä?",
     ans: "‡§ï‡•É‡§∑‡§ø ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞"
   });
 }

 if(facts.length === 0){
   return alert("‡§á‡§∏ ‡§≤‡•á‡§ñ ‡§∏‡•á ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§§‡§•‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á");
 }

 /* ---------- Convert facts ‚Üí MCQ ---------- */
 facts.forEach(f=>{
   let wrongs = [
     "‡§≤‡•ã‡§π‡§æ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ",
     "‡§ï‡•á‡§µ‡§≤ ‡§∂‡§ø‡§ï‡§æ‡§∞ ‡§™‡§∞ ‡§®‡§ø‡§∞‡•ç‡§≠‡§∞",
     "‡§ï‡•ã‡§à ‡§â‡§≤‡•ç‡§≤‡•á‡§ñ ‡§®‡§π‡•Ä‡§Ç"
   ];

   // shuffle first 3
   wrongs.sort(()=>Math.random()-0.5);

   let options = [f.ans, wrongs[0], wrongs[1]];
   options.sort(()=>Math.random()-0.5);
   options.push("‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç"); // D ‡§π‡§Æ‡•á‡§∂‡§æ

   const letters = ["A","B","C","D"];
   const correct = letters[options.indexOf(f.ans)];

   DB[exam][subject][topic].push({
     q: f.q,
     a: options[0],
     b: options[1],
     c: options[2],
     d: options[3],
     correct: correct,
     exp: "‡§≤‡•á‡§ñ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§π‡•à: " + f.ans
   });
 });

 saveDB();
 show();
 alert("‡§≤‡•á‡§ñ ‡§∏‡•á ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï MCQ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§®‡•á");
}
